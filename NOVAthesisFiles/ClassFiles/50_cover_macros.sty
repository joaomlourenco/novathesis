%% COVER DEFINITION MACROS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand*{\ntresetcovers}{%
  \@for\arg:={1-1,1-2,2-1,2-2,N-1,N-2}\do{%
    \ntresetonecover{\arg}%
  }%
}

\newcommand*{\ntresetonecover}[1]{%
    \option@setnil{/@nt/cover/\@UNIV/\@SCHL/#1}%
}


\newcommand*{\ntaddtocover}[3][]{%
  % #1 = cover atrtibutes
  % #2 = list of covers where the code block should be applied
  % #3 = the block code
  % \typeout{NT ntaddtocover [/@nt/cover/\@UNIV/\@SCHL/element=#1]}%
  % \forcsvlist{\@ntaddtocover@iii{#1}{#3}}{#2}%
  \ntfor\arg:={#2}\do{\@ntaddtocover@iii{#1}{#3}{\arg}}%
}

\newcommand*{\@ntaddtocover@iii}[3]{%
  % \typeout{NT ntaddtocover #3}%
  % #1 = cover atrtibutes
  % #2 = the block code
  % #3 = covers where the code block should be applied
  \options{/@nt/cover/\@UNIV/\@SCHL/#3/.newpush={{#1}\@nil{#2}}}%
}

%==========================================
\NewDocumentCommand{\ntAddToCoverTikz}{d<>O{}r()O{}mm}{%
  % #1=Command
  % #2=Options
  % #3=Position
  % #4=Rest of command
  % #5=CIDLIST
  % #6=Code
  % \typeout{Command=[#1]  Options=[#2]  Position=[#3]  Rest of command=[#4]  CIDLIST=[#5]  Code=[]}\NTADDTOCOVERTIKZ
  \ntfor\cvids:={#5}\do{\ntAddToOneCoverTikz{#1}{#2}{#3}{#4}{\cvids}{#6}}%
}

\NewDocumentCommand{\ntAddToOneCoverTikz}{mmmmmm}{%
  % #1=Command
  % #2=Options
  % #3=Position
  % #4=Rest of command
  % #5=CID
  % #6=Code
  % \typeout{Command=[#1]  Options=[#2]  Position=[#3]  Rest of command=[#4]  CIDLIST=[#5]  Code=[]}\NTADDTOONECOVERTIKZ
  \options{/@nt/coverTikz/\@UNIV/\@SCHL/#5/.newpush=
                {{#1}\@nil{#2}\@nil{#3}\@nil{#4}\@nil{#6}}}%
}

\NewDocumentCommand{\printCoverTikz}{m}{%
  % #1 = cover ID (major-minor)
  % \typeout{@NTCOVERTEXT 1=[#1]}\@NTCOVERTEXT%
  \ifoptiondefined{/@nt/coverTikz/\@UNIV/\@SCHL/#1}{%
    \NTRunHook{coverTikz/#1/text/pre}%
    \begin{tikzpicture}[remember picture, overlay, yscale=-1, every node/.style={inner sep=0pt}]%
      \optionlistdo{/@nt/coverTikz/\@UNIV/\@SCHL/#1}{%
        \printCoverElementTikz#1\@nil##1\@nil\@nil%
      }%
    \end{tikzpicture}%
    \NTRunHook{coverTikz/#1/text/post}%
  }{}%
}

\def\printCoverElementTikz#1\@nil#2\@nil#3\@nil#4\@nil#5\@nil#6\@nil{%
  % #1=CID
  % #2=Command
  % #3=Options
  % #4=Position
  % #5=Rest of command
  % #6=Code
  % \node[inner sep=0,#2] at (#1) {Pos=[#1] Opt=[#2] CID=[#3] COD=[#4]};
  % \typeout{ CID=[#1] CMD=\string#2[#3] at (#4) --#5--}\TIKZCOVER
  \IfNoValueTF {#2} {\node[#3] at (#4) #5 {#6}} {#2[#3] (#4) #5};
}
%==========================================



